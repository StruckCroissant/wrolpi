{% extends 'lib/plugins/videos/templates/channels.html' %}
{% set title="Manage Channels" %}

{% block video %}
    <div class="container">

        <div class="row" style="margin-bottom: 4em">
            <div class="col-12">
                <h1>Global Video Settings</h1>
                <form action="/api/videos/settings" id="settings">
                    <div class="form-group">
                        <h5>Video Root Directory</h5>
                        <input name="video_root_directory" value="{{ video_root_directory|e }}" class="form-control"/>
                        <small class="text-muted">
                            The directory that contains (or will contain) all
                            the video files and directories. This should be changed from the provided
                            <i>examples</i> directory.
                        </small>

                        <h5>Video File Naming Schema</h5>
                        <input name="file_name_format" class="form-control"
                               value="{{ file_name_format|e }}"/>
                        <small class="text-muted">
                            The way each video's files will be named. The default value will allow videos
                            to easily be sorted by upload date, it's unique id, as well as who uploaded them.
                        </small>
                    </div>

                    {{ put_form_button('settings', 'primary', 'Save Settings') }}
                </form>
            </div>
        </div>

        <div class="row" style="margin-bottom: 4em">
            <div class="col-12">
                <h1>Content Maintenence Tasks</h1>
                <div class="row">
                    <div class="col-4">
                        <form id="refresh" action="/api/videos/settings/refresh">
                            {{ post_form_button('refresh', 'dark', 'Refresh Video Files.') }}
                        </form>
                    </div>
                    <div class="col-8">
                        <p>
                            Search for new videos files.  Process any missing captions.
                        </p>
                        <pre>./main.py content -r</pre>
                    </div>
                </div>

                <div class="row">
                    <div class="col-4">
                        <form id="download" action="/api/videos/settings/download">
                            <pre class="stream-feed"></pre>
                            {{ post_form_button('download', 'dark', 'Download New Videos') }}
                        </form>
                    </div>
                    <div class="col-8">
                        <p>
                            Update video list for each channel, then download any missing videos.
                        </p>
                        <pre>./main.py download</pre>
                    </div>
                </div>

            </div>
        </div>

        <div class="row" style="margin-bottom: 100px;">

            <div class="col-8">
                <h1>Add New Channel</h1>
                <form id="new_channel" method="POST" action="/api/videos/channel">
                    <div class="form-group">
                        <label>Channel URL</label>
                        <input type="text" class="form-control" name="url" placeholder="https://example.com/channel"
                               required>
                    </div>

                    <div class="form-group">
                        <label>Channel Name</label>
                        <input type="text" class="form-control" name="name" placeholder="Short readable name" required
                               aria-required="true">
                    </div>

                    <div class="form-group">
                        <label>Channel Directory</label>
                        <input type="text" class="form-control" name="directory" placeholder="videos/something" required
                               aria-required="true">
                        <small id="name_help" class="form-text text-muted">This will be appended to the root directory
                            in the config, unless its an absolute path.</small>
                    </div>

                    <hr>

                    <div class="form-group">
                        <label>Title Match Regex</label>
                        <input type="text" class="form-control" name="match_regex" placeholder=".*(prepper|prepping).*">
                        <small class="form-text text-muted">
                            The title of the video will be compared to this Regular Expression. If you don't input this,
                            all
                            videos will be downloaded.
                        </small>
                    </div>

                    {{ post_form_button('new_channel', 'primary', 'Add Channel') }}
                </form>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <h1>Update Existing Channels</h1>
                <p class="lead">
                    Edit your existing channels. Directories cannot be modified.
                </p>
            </div>
        </div>

        {% for channel in channels %}
            <div class="row" style="margin-top: 40px; margin-bottom: 25px">
                <div class="col-4">
                    <h4>{{ channel['name'] }}</h4>
                </div>
                <div class="col-8">
                    {% set link=channel['link'] or '' %}
                    {% set name=channel['name'] or '' %}
                    {% set url=channel['url'] or '' %}
                    {% set directory=channel['directory'] or '' %}
                    {% set match_regex=channel['match_regex'] or '' %}
                    <form action="/api/videos/channel/{{ link }}" id="{{ link }}">
                        <div class="form-group">
                            <label>Channel URL</label>
                            <input type="text" class="form-control" name="url"
                                   placeholder="https://example.com/channel" value="{{ url }}">
                        </div>

                        <div class="form-group">
                            <label>Channel Name</label>
                            <input type="text" class="form-control" name="name"
                                   placeholder="Short readable name" value="{{ name }}" required aria-required="true">
                        </div>

                        <div class="form-group">
                            <label>Channel Directory</label>
                            <input type="text" class="form-control" name="directory"
                                   placeholder="videos/something" value="{{ directory }}" required
                                   aria-required="true" disabled/>
                            <small id="name_help" class="form-text text-muted">This will be appended to the root
                                directory
                                in the config, unless its an absolute path.</small>
                        </div>

                        <hr>

                        <div class="form-group">
                            <label>Title Match Regex</label>
                            <input type="text" class="form-control" name="match_regex"
                                   placeholder=".*(prepper|prepping).*" value="{{ match_regex }}">
                            <small class="form-text text-muted">
                                The title of the video will be compared to this Regular Expression. If you don't input
                                this,
                                all
                                videos will be downloaded.
                            </small>
                        </div>

                        {{ put_form_button(link, 'info', 'Update') }}
                        {{ delete_form_button(link, 'danger', 'Delete') }}
                    </form>
                </div>
            </div>
        {% endfor %}
    </div>
{% endblock %}